<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:MyProject"
             xmlns:local="clr-namespace:MyProject"
             x:Class="MyProject.MainPage"
             Padding="10">

    <ContentPage.Resources>
        <ResourceDictionary>
            <local:BoolToStarConverter x:Key="BoolToStarConverter" />
            <local:InverseBoolConverter x:Key="InverseBoolConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <StackLayout Spacing="15">

        <StackLayout Spacing="4"
                     HorizontalOptions="Center"
                     Margin="0,10">

            <Label Text="🎬 Movie Explorer"
                   FontSize="26"
                   FontAttributes="Bold"
                   HorizontalOptions="Center"/>

            <Label Text="Discover, rate &amp; favorite your movies"
                   FontSize="13"
                   Opacity="0.7"
                   HorizontalOptions="Center"/>
        </StackLayout>

        <!-- Search Bar -->
        <StackLayout Spacing="10">
            <SearchBar x:Name="MovieSearchBar"
                       Placeholder="Search movies..."
                       TextChanged="SearchBar_TextChanged"/>

        <!-- Director Filter Entry -->
        <StackLayout Orientation="Horizontal" Spacing="10">
            <Label Text="Director:" VerticalOptions="Center"/>
            <Entry x:Name="DirectorFilterEntry"
                   Placeholder="Filter by director..."
                   TextChanged="DirectorFilterEntry_TextChanged"
                   HorizontalOptions="FillAndExpand"/>
        </StackLayout>
    </StackLayout>

        <!-- Sorting, Favorites, History Row -->
        <Grid ColumnSpacing="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <Button Text="{Binding SortOrderText}"
                    Clicked="SortOrderButton_Clicked"
                    Grid.Column="0"/>

            <Picker x:Name="SortPicker"
                    Title="Sort by"
                    SelectedIndexChanged="SortPicker_SelectedIndexChanged"
                    Grid.Column="1">
                <Picker.ItemsSource>
                    <x:Array Type="{x:Type x:String}">
                        <x:String>Rating</x:String>
                        <x:String>Year</x:String>
                        <x:String>Title</x:String>
                    </x:Array>
                </Picker.ItemsSource>
            </Picker>

            <StackLayout Orientation="Horizontal"
                         VerticalOptions="Center"
                         Grid.Column="3"
                         Spacing="5">
                 <Label Text="Favorites Only" VerticalOptions="Center"/>
                 <Switch IsToggled="{Binding ShowFavoritesOnly}" VerticalOptions="Center"/>
            </StackLayout>


            <Button Text="📜 History"
                    Clicked="HistoryButton_Clicked"
                    Grid.Column="4"/>
            </Grid>

        <Grid VerticalOptions="FillAndExpand">

            <!-- Movie List -->
            <RefreshView IsRefreshing="{Binding IsRefreshing}"
                 Command="{Binding RefreshMoviesCommand}">
                <CollectionView x:Name="MoviesCollectionView"
                        ItemsSource="{Binding FilteredMovies}"
                        SelectionMode="Single"
                        SelectionChanged="CollectionView_SelectionChanged"
                        VerticalOptions="FillAndExpand">
                    <CollectionView.ItemsLayout>
                        <LinearItemsLayout Orientation="Vertical" ItemSpacing="5"/>
                    </CollectionView.ItemsLayout>
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Frame CornerRadius="12" Padding="10" HasShadow="True" Background="{DynamicResource CardBackgroundBrush}">
                                <Grid ColumnSpacing="10">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Emoji -->
                                    <Label ClassId="MovieEmojiLabel"
                                   Text="{Binding emoji}" 
                                   FontSize="30"
                                   VerticalOptions="Center"
                                   Grid.Column="0"/>

                                    <!-- Movie Details -->
                                    <StackLayout Orientation="Vertical" 
                                         Spacing="2"
                                         Grid.Column="1">
                                        <Label Text="{Binding title}" FontAttributes="Bold" />
                                        <Label Text="{Binding year}" FontSize="12" />
                                        <Label Text="{Binding director}" FontSize="12" />
                                        <Label Text="{Binding rating}" FontSize="12" />
                                        <Label Text="{Binding genreString}" FontSize="12" />
                                    </StackLayout>

                                    <!-- Favorite button -->
                                    <Button Text="{Binding IsFavorite, Converter={StaticResource BoolToStarConverter}}"
                                            Clicked="FavoriteButton_Clicked"
                                            FontSize="20"
                                            VerticalOptions="Center"
                                            HorizontalOptions="End"
                                            Grid.Column="2"/>
                                </Grid>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </RefreshView>

            <!-- Empty state messages -->
            <StackLayout HorizontalOptions="Center"
                         VerticalOptions="Center"
                         Spacing="10"
                         IsVisible="{Binding HasMovies, Converter={StaticResource InverseBoolConverter}}">
                <Label Text="😢 No movies found."
                       FontSize="16"/>
                <Label Text="⭐ No favorites yet."
                       FontSize="16"
                       IsVisible="{Binding HasFavorites, Converter={StaticResource InverseBoolConverter}}" />
            </StackLayout>

        </Grid>

    </StackLayout>
</ContentPage>



